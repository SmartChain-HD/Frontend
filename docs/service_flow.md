# 서비스 플로우

## 개요

```
┌───────────────────────────────────────────────────────────────────────┐
│                                  사용자                                │
│                                    │                                  │
│                                    ▼                                  │
│                            로그인 / 회원가입                             │
│                                    │                                  │
│                                    ▼                                  │
│         ┌──────────┬───────────────┼───────────────┐                  │
│         ▼          ▼               ▼               ▼                  │
│      게스트     기안자          결재자               수신자                │
│                              (ESG 전용)                                │
└───────────────────────────────────────────────────────────────────────┘
```

---

## 게스트 플로우

```
    권한 요청 (도메인 + 역할 선택)
         │
         ▼
    승인 대기 ───────────────────▶ 승인 완료 ───▶ 해당 역할로 전환
```

---

## ESG 실사 (3단계: 기안자 → 결재자 → 수신자)

```
[기안자]                        [결재자]                      [수신자]
    │                              │                            │
    ▼                              │                            │
  진단 작성 (WRITING)              │                            │
    │                              │                            │
    ▼                              │                            │
  증빙 업로드 (ESG 문서)            │                            │
    │                              │                            │
    ▼                              │                            │
  AI 파싱 (증빙 자동 추출)          │                            │
    │                              │                            │
    ▼                              │                            │
  AI 분석 (ESG 리포트)             │                            │
    │                              │                            │
    ▼                              │                            │
  결재 제출 (SUBMITTED) ─────────▶ 결재 대기                     │
                                   │                            │
                              ┌────┴────┐                       │
                              ▼         ▼                       │
                            반려      승인                       │
                              │         │                       │
                              ▼         ▼                       │
                    기안자에게 반송   수신자 제출 ──────────────▶ 심사
                    (RETURNED)      (REVIEWING)
```

---

## 안전보건 (2단계: 기안자 → 수신자, 결재 없음)

```
[기안자]                                                      [수신자]
    │                                                            │
    ▼                                                            │
  진단 작성 (WRITING)                                            │
    │                                                            │
    ▼                                                            │
  증빙 업로드 (TBM 영상)                                          │
    │                                                            │
    ▼                                                            │
  AI 분석 (TBM 영상 분석)                                         │
    │                                                            │
    ▼                                                            │
  수신자 직접 제출 (REVIEWING) ─────────────────────────────────▶ 심사
```

---

## 컴플라이언스 (2단계: 기안자 → 수신자, 결재 없음)

```
[기안자]                                                      [수신자]
    │                                                            │
    ▼                                                            │
  진단 작성 (WRITING)                                            │
    │                                                            │
    ▼                                                            │
  증빙 업로드 (하도급 계약서)                                      │
    │                                                            │
    ▼                                                            │
  AI 분석 (LLM 계약서 검토)                                       │
    │                                                            │
    ▼                                                            │
  수신자 직접 제출 (REVIEWING) ─────────────────────────────────▶ 심사
```

---

## 수신자 공통 플로우

```
[수신자 기능]
    │
    │
    ├──▶ 권한 관리 (역할 요청 승인/거절)
    │
    └──▶ 심사 대시보드 (도메인 필터)
              │
              ▼
         심사 목록 조회
              │
              ▼
         심사 상세 (AI 결과 확인)
              │
              ▼
         심사 판단
              │
         ┌────┴────┐
         ▼         ▼
       보완요청   승인
         │         │
         ▼         ▼
   기안자에게    완료 (COMPLETED)
   반송              │
   (RETURNED)        ▼
                 리포트 생성 (단건/일괄)
                     │
                     ▼
                 데이터 내보내기 (Excel/CSV)
```

---

## 상태 전이 요약

### ESG
```
WRITING → SUBMITTED → RETURNED (반려 시)
                    → APPROVED → REVIEWING → RETURNED (보완요청 시)
                                           → COMPLETED
```

### SAFETY / COMPLIANCE
```
WRITING → REVIEWING → RETURNED (보완요청 시)
                    → COMPLETED
```

---

## 도메인별 비교

| 도메인 | 단계 | 워크플로우 |
|--------|------|-----------|
| **ESG** | 3단계 | 기안자 → 결재자 → 수신자 |
| **SAFETY** | 2단계 | 기안자 → 수신자 (결재 없음) |
| **COMPLIANCE** | 2단계 | 기안자 → 수신자 (결재 없음) |
