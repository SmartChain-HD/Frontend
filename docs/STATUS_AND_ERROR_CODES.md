# 상태 코드 및 에러 코드 참조

> **버전**: 1.1
> **최종 수정**: 2026-01-28
> **목적**: 시스템 상태 코드 및 에러 코드의 단일 참조 문서

---

## 1. 서비스 도메인 코드 (DomainCode)

| 코드 | 한글명 | 영문명 | 설명 |
|------|-------|--------|------|
| `ESG` | ESG 실사 | ESG Due Diligence | ESG 증빙 자동 파싱 및 AI 리포트 생성 |
| `SAFETY` | 안전보건 | Safety & Health | AI 기반 현장 안전점검(TBM) 자동 검증 |
| `COMPLIANCE` | 컴플라이언스 | Compliance | LLM 기반 하도급 계약서 자동 검토 |

---

## 2. 역할 코드 (RoleCode)

| 코드 | 한글명 | 영문명 | 권한 설명 |
|------|-------|--------|----------|
| `GUEST` | 게스트 | Guest | 회원가입 직후, 권한 요청만 가능 |
| `DRAFTER` | 기안자 | Drafter | 협력사 작성 직원. 진단 데이터 작성/업로드 |
| `APPROVER` | 결재자 | Approver | 협력사 팀장. 회사 정보 관리, 결재 처리 |
| `REVIEWER` | 수신자 | Reviewer | 원청 담당자. 심사, 보고서 발행, 권한 관리 |

### 역할별 기능 매트릭스

| 기능 | GUEST | DRAFTER | APPROVER | REVIEWER |
|------|-------|---------|----------|----------|
| 권한 요청 | O | O | O | O |
| 진단 작성 | X | O | X | X |
| 진단 제출 | X | O | X | X |
| 결재 처리 | X | X | O | X |
| 원청 제출 | X | X | O | X |
| 심사 처리 | X | X | X | O |
| 보고서 발행 | X | X | X | O |
| 권한 관리 | X | X | X | O |

---

## 3. 진단 상태 (DiagnosticStatus)

```
WRITING → SUBMITTED → RETURNED (반려 시)
                   ↓
              APPROVED → REVIEWING → COMPLETED
```

| 상태 | 한글명 | 설명 | 다음 가능 상태 |
|------|-------|------|---------------|
| `WRITING` | 작성중 | 기안자가 진단 작성 중 | SUBMITTED |
| `SUBMITTED` | 제출됨 | 결재자에게 제출됨 | RETURNED, APPROVED |
| `RETURNED` | 반려됨 | 결재자가 반려함 | WRITING |
| `APPROVED` | 내부승인 | 결재자가 승인함 | REVIEWING |
| `REVIEWING` | 심사중 | 원청에서 심사 중 | COMPLETED |
| `COMPLETED` | 완료 | 심사 완료 | (최종 상태) |

---

## 4. 결재 상태 (ApprovalStatus)

| 상태 | 한글명 | 설명 |
|------|-------|------|
| `WAITING` | 결재전 | 결재 대기 중 |
| `APPROVED` | 결재 완료 | 결재 승인됨 |
| `REJECTED` | 반려 | 결재 반려됨 |

---

## 5. 심사 상태 (ReviewStatus)

| 상태 | 한글명 | 설명 |
|------|-------|------|
| `REVIEWING` | 심사중 | 원청에서 심사 진행 중 |
| `APPROVED` | 승인 | 심사 승인 완료 |
| `REVISION_REQUIRED` | 보완요청 | 보완 필요 |

---

## 6. 권한 요청 상태 (RequestStatus)

| 상태 | 한글명 | 설명 |
|------|-------|------|
| `PENDING` | 승인 대기중 | 관리자 승인 대기 |
| `APPROVED` | 승인 완료 | 권한 부여 완료 |
| `REJECTED` | 승인 반려 | 권한 거부됨 |

---

## 7. 작업 상태 (JobStatus)

비동기 AI 작업의 상태:

| 상태 | 한글명 | 설명 |
|------|-------|------|
| `PENDING` | 대기중 | 작업 대기 |
| `RUNNING` | 진행중 | 작업 실행 중 |
| `SUCCEEDED` | 성공 | 작업 완료 |
| `FAILED` | 실패 | 작업 실패 (재시도 가능 여부 확인) |

---

## 8. 에러 코드 체계

### 8.1 코드 형식

```
{도메인}_{시퀀스} 또는 {도메인}{시퀀스}
```

| 도메인 접두사 | 설명 |
|-------------|------|
| `U` | 사용자 (User) |
| `A` | 인증 (Auth) |
| `R` | 역할/권한 요청 (Role) |
| `C` | 회사 (Company) |
| `D` | 진단 (Diagnostic) |
| `E` | 증빙파일 (Evidence) |
| `AP` | 결재 (Approval) |
| `RV` | 심사 (Review) |
| `PERM` | 권한 에러 (Permission) |
| `DOM` | 도메인 에러 (Domain) |
| `AI` | AI 서비스 에러 |
| `S` | 서버 에러 (Server) |

### 8.2 400 Bad Request

| 코드 | 메시지 | 대응 방법 |
|------|--------|----------|
| `U001` | 입력값이 올바르지 않습니다 | 입력 필드 검증 |
| `U002` | 이미 존재하는 이메일입니다 | 다른 이메일 사용 |
| `U004` | 비밀번호가 일치하지 않습니다 | 비밀번호 재확인 |
| `U005` | 비밀번호 형식 오류 | 형식 안내 표시 |
| `U006` | 필수 약관에 동의해야 합니다 | 약관 동의 유도 |
| `U008` | 인증 코드가 만료되었습니다 | 재발송 유도 |
| `U009` | 인증 코드가 올바르지 않습니다 | 재입력 유도 |
| `R004` | 유효하지 않은 권한입니다 | 올바른 역할 선택 |
| `R005` | 유효하지 않은 처리 결과입니다 | APPROVED/REJECTED만 허용 |
| `DOM001` | 유효하지 않은 도메인 코드입니다 | ESG/SAFETY/COMPLIANCE 선택 |
| `AP001` | 유효하지 않은 결재 처리입니다 | APPROVED/REJECTED만 허용 |

### 8.3 401 Unauthorized

| 코드 | 메시지 | 대응 방법 |
|------|--------|----------|
| `A001` | 유효하지 않은 토큰입니다 | 로그인 페이지로 이동 |
| `A002` | 만료된 토큰입니다 | 토큰 갱신 또는 재로그인 |
| `A003` | 이메일 또는 비밀번호가 올바르지 않습니다 | 재입력 유도 |

### 8.4 403 Forbidden

| 코드 | 메시지 | 대응 방법 |
|------|--------|----------|
| `A004` | 접근 권한이 없습니다 | 권한 안내 |
| `PERM_001` | 해당 리소스에 대한 접근 권한이 없습니다 | 권한 요청 유도 |
| `PERM_002` | 해당 작업을 수행할 권한이 없습니다 | 권한 안내 |
| `DOM002` | 해당 도메인에 대한 접근 권한이 없습니다 | 도메인 권한 요청 유도 |

### 8.5 404 Not Found

| 코드 | 메시지 | 대응 방법 |
|------|--------|----------|
| `U003` | 사용자를 찾을 수 없습니다 | 목록으로 이동 |
| `R001` | 역할을 찾을 수 없습니다 | 새로고침 |
| `R002` | 권한 요청을 찾을 수 없습니다 | 목록으로 이동 |
| `C001` | 회사를 찾을 수 없습니다 | 목록으로 이동 |
| `D001` | 진단을 찾을 수 없습니다 | 목록으로 이동 |
| `DOM003` | 도메인을 찾을 수 없습니다 | 유효한 도메인 코드 사용 |
| `AP002` | 결재를 찾을 수 없습니다 | 목록으로 이동 |
| `RV001` | 심사를 찾을 수 없습니다 | 목록으로 이동 |

### 8.6 409 Conflict

| 코드 | 메시지 | 대응 방법 |
|------|--------|----------|
| `R003` | 이미 대기중인 권한 요청이 있습니다 | 기존 요청 상태 확인 유도 |
| `PERM_003` | 이미 처리된 권한 요청입니다 | 목록 새로고침 |
| `AP003` | 이미 처리된 결재입니다 | 목록 새로고침 |
| `D002` | 진단이 이미 제출되었습니다 | 상태 확인 |

### 8.7 429 Too Many Requests

| 코드 | 메시지 | 대응 방법 |
|------|--------|----------|
| `U010` | 잠시 후 다시 시도해주세요 | 카운트다운 표시 |

### 8.8 500 Internal Server Error

| 코드 | 메시지 | 대응 방법 |
|------|--------|----------|
| `S001` | 서버 오류가 발생했습니다 | 재시도 버튼 |
| `S002` | 파일 업로드에 실패했습니다 | 재시도 유도 |
| `S003` | AI 서비스 연동에 실패했습니다 | 재시도 유도 |

### 8.9 AI Run API 에러 코드

| 코드 | HTTP 상태 | 메시지 | 대응 방법 |
|------|----------|--------|----------|
| `AI001` | 503 | AI 서비스에 연결할 수 없습니다 | 잠시 후 재시도 |
| `AI002` | 409 | 이미 분석이 진행 중입니다 | 기존 분석 완료 대기 |
| `AI003` | 404 | AI 분석 결과를 찾을 수 없습니다 | 분석 요청 먼저 수행 |
| `AI007` | 422 | 필수 슬롯에 해당하는 파일이 제출되지 않았습니다 | preview API로 missingRequiredSlots 확인 후 필수 파일 업로드 |
| `BIZ_004` | 422 | 필수 증빙 파일이 누락되었습니다 | 필수 증빙 파일 업로드 후 재시도 |

---

## 9. 프론트엔드 에러 처리 예시

```typescript
const ERROR_HANDLERS: Record<string, ErrorConfig> = {
  // 인증 에러
  'A001': { action: 'redirect', redirectTo: '/login' },
  'A002': { action: 'silent' }, // interceptor에서 처리
  'A003': { action: 'toast', customMessage: '이메일 또는 비밀번호를 확인해주세요' },

  // 도메인 권한 에러
  'DOM002': { action: 'toast', customMessage: '해당 도메인에 대한 권한이 없습니다' },
  'PERM_001': { action: 'toast' },
  'PERM_002': { action: 'toast' },

  // AI 서비스 에러
  'AI001': { action: 'toast', customMessage: 'ESG 파싱에 실패했습니다. 잠시 후 다시 시도해주세요' },
  'AI002': { action: 'toast', customMessage: 'TBM 분석에 실패했습니다. 잠시 후 다시 시도해주세요' },
  'AI003': { action: 'toast', customMessage: '계약서 검토에 실패했습니다. 잠시 후 다시 시도해주세요' },

  // 서버 에러
  'S001': { action: 'toast', customMessage: '서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요' },
};
```

---

## 10. 참고 문서

- [API Contract SSOT](./API_CONTRACT_SSOT.md)
- [API Quick Reference](./API_QUICK_REFERENCE.md)
- [Frontend Integration Rules](./FE_INTEGRATION_RULES.md)
